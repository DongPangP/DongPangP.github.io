<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>前端Excel下载</title>
      <link href="2021/06/03/%E5%89%8D%E7%AB%AFExcel%E4%B8%8B%E8%BD%BD/"/>
      <url>2021/06/03/%E5%89%8D%E7%AB%AFExcel%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<p><span style="color:red;font-size: 20px">本文借鉴</span> <a href="https://juejin.cn/post/6844903880413675527">纯前端用XLSX库导出excel，可含多个sheet (juejin.cn)</a></p><h2 id="导出逻辑"><a href="#导出逻辑" class="headerlink" title="导出逻辑"></a>导出逻辑</h2><ul><li><p>excel整个表格专业名词是<span style="color:yellow"> workbook</span>，里面每张表格是 <span style="color:yellow">sheet</span></p></li><li><p>页面引入 xlsx 的库 ，<a href="https://unpkg.com/xlsx/dist/xlsx.core.min.js">https://unpkg.com/xlsx/dist/xlsx.core.min.js</a></p></li><li><p>vue中引入xlsx的库</p><pre><code>1、npm install xlsx 2、import XLSX from &#39;xlsx&#39;</code></pre></li><li><p>把数据生成<span style="color:yellow">sheet</span></p><pre><code>var sheet = XLSX.utils.json_to_sheet(jsonData)/* json_to_sheet：将由对象组成的数组转换成sheet   aoa_to_sheet：将由二维数组转换成sheet   table_to_sheet：将table的dom直接转成sheet*/</code></pre></li><li><p>创建虚拟的 <span style="color:yellow">workbook</span></p><pre><code>const wb = XLSX.utils.book_new()</code></pre></li><li><p>把<span style="color:yellow">sheet</span>添加到<span style="color:yellow">workbook</span>里</p><pre><code>XLSX.utils.book_append_sheet(wb, sheet, &quot;这里是sheetName&quot;);</code></pre></li><li><p>把 <span style="color:yellow">workbook</span>转成<span style="color:yellow">blob</span></p><pre><code>const blob = workbook2blob(wb);//看下面的js代码</code></pre></li><li><p>利用a标签和createObjectURl实现下载功能</p><pre><code>openDownloadDialog(blob,&#39;excel的标题.xlsx&#39;);</code></pre></li></ul><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><pre><code class="js">/** * 生成表格 */import XLSX from &#39;xlsx&#39;;// 将workbook转换成blob对象function workbook2blob(data) &#123;  // 生成excel的配置项  const wopts = &#123;    // 要生成的文件类型    bookType: &#39;xlsx&#39;,    // 是否生成Shared String Table，    // 官方解释时，如果开启生成速度会降低，但在低版本IOS设备上有更好的兼容性    bookSST: false,    type: &#39;binary&#39;  &#125;  const wbout = XLSX.write(data, wopts);  // 将字符串转 ArrayBuffer  function s2ab(s) &#123;    const buf = new ArrayBuffer(s.length);    const view = new Uint8Array(buf);    for (let i = 0; i !== s.length; ++i) view[i] = s.charCodeAt(i) &amp; 0xff;    return buf;  &#125;  const blob = new Blob([s2ab(wbout)], &#123;    type: &#39;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;&#39;  &#125;);  return blob;&#125; // 将blob对象创建bloburl，然后用a标签实现弹出下载框 function openDownloadDialog(blob, fileName) &#123;  if (typeof blob === &#39;object&#39; &amp;&amp; blob instanceof Blob) &#123;    blob = URL.createObjectURL(blob); // 创建blob地址  &#125;  const aLink = document.createElement(&#39;a&#39;);  aLink.href = blob;  // HTML5新增的属性，指定保存文件名，可以不要后缀，注意，有时候 file:///模式下不会生效  aLink.download = fileName || &#39;&#39;;  let event;  if (window.MouseEvent) &#123;    event = new MouseEvent(&#39;click&#39;);  &#125; else &#123; //   移动端    event = document.createEvent(&#39;MouseEvents&#39;);    event.initMouseEvent(&#39;click&#39;, true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);  &#125;  aLink.dispatchEvent(event);&#125;export default&#123;  workbook2blob,  openDownloadDialog&#125;</code></pre><pre><code class="js"> /**  * 转换下载ip数据  */async generateAndDownload() &#123;  try&#123;    const info = await this.getIpInfoAll();        const data = info.data.response.data;        if(data.length &gt; 0) &#123;        const sheetData = [];        for(let i = 0, len = data.length; i &lt; len; i++) &#123;           for(let j = 0, len = this.Category.length; j &lt; len; j++) &#123;            if(data[i].EquipmentCategory === this.Category[j].value) &#123;              data[i].EquipmentCategory = this.Category[j].label;              break;            &#125;          &#125;          const obj = &#123;             名称: data[i].EquipmentName,             IP地址: data[i].IPaddr,             Mac地址: data[i].MacAddr,             类型: data[i].EquipmentCategory,             备注: data[i].Note           &#125;           sheetData.push(obj);         &#125;         const sheet = XLSX.utils.json_to_sheet(sheetData);         /* create a new blank workbook */         const wb = XLSX.utils.book_new();         XLSX.utils.book_append_sheet(wb, sheet, &#39;IP信息&#39;);      const workbookBlob = generate.workbook2blob(wb);         generate.openDownloadDialog(workbookBlob, &#39;IP信息&#39;);    &#125;catch(err)&#123;      this.$message.error(&#39;下载出错！&#39;);    &#125;    &#125;    &#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
          <category> 拓展 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> xlsx库 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
